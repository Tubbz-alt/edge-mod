{% extends "base.html" %}
{% load site_tags %}
{% load staticfiles %}
{% block head-title %}{{ main_title }}{% endblock %}
{% block head-content %}

    <style type="text/css">
        ul.dragdrop {
            height: 240px;
            overflow-y: auto;
            -webkit-user-select: none;
            -moz-user-select: -moz-none;
            -ms-user-select: none;
            -o-user-select: none;
            user-select: none;
        }

        ul.dragdrop li.draggable {
            cursor: move;
            padding: 0.25em;
        }

        ul.dragdrop li div.edgeTypeIcon {
            background-repeat: no-repeat;
            height: 20px;
            margin-right: 0.25em;
            width: 23px;
        }

        ul.dragdrop li span {
            display: inline-block;
            height: 20px;
            line-height: 20px;
        }
    </style>

{% endblock %}

{% block body-content %}
    <div class="container">

        <div data-bind="visible: !selectedIncident()">
            <div class="row">
                <div class="col-sm-12">
                    <form action="" onsubmit="return false;">
                        <label for="search">Search</label>
                        <input id="search" name="search" data-bind="value: search" maxlength="50" size="50"/>
                    </form>
                </div>
            </div>
            <div data-bind="visible: hasResults()">
                <div class="row">
                    <div class="col-sm-12">
                        <table class="table table-striped table-condensed">
                            <thead>
                            <tr>
                                <th class="text-center">Date</th>
                                <th class="text-center">Title</th>
                            </tr>
                            </thead>
                            <tbody data-bind="foreach: results">
                            <tr class="datarow">
                                <td data-bind="text: moment(date).calendar()" class="text-center"></td>
                                <td class="text-left"><a href=""
                                                         data-bind="text: title, click: $parent.select.bind($parent)"
                                                         title="Select this incident"></a></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div data-bind="visible: selectedIncident(), with: selectedIncident">
            <div class="row">
                <div class="col-sm-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Summary
                                <button class="pull-right btn btn-default btn-xs" data-bind="click: $parent.unselect.bind($parent)">Select again
                                </button>
                            </h3>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-sm-6">
                                    <dl class="dl-horizontal">
                                        <dt>Title</dt>
                                        <dd data-bind="text: title"></dd>
                                        <dt>Short Description</dt>
                                        <dd data-bind="html: short_description_html"></dd>
                                        <dt>Description</dt>
                                        <dd data-bind="html: description_html"></dd>
                                    </dl>
                                </div>
                                <div class="col-sm-6">
                                    <dl class="dl-horizontal">
                                        <dt>Created</dt>
                                        <dd data-bind="text: moment(created_on).calendar()"></dd>
                                        <dt>by</dt>
                                        <dd data-bind="html: created_by_username"></dd>
                                        <dt>ETLP</dt>
                                        <dd data-bind="html: etlp"></dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Related indicators, TTPs, COAs and incidents</h3>
                        </div>
                        <div class="panel-body">
                            <ul data-bind="foreach: $parent.availableEdges, dropZone: { accepts: 'selected.edges', drop: $parent.onUnselected.bind($parent) } "
                                class="list-unstyled dragdrop">
                                <li data-bind="attr: { title: id_ }, dragZone: { name: 'available.edges' }">
                                    <div data-bind="attr: {
                                        title: type
                                    }, style: {
                                        backgroundImage: 'url(\'{% static '' %}' + '/img/hex/hex_' + ty + '_20.png\')'
                                    }" class="pull-left edgeTypeIcon"></div>
                                    <span data-bind="text: title"></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Selected indicators, TTPs, COAs and incidents</h3>
                        </div>
                        <div class="panel-body">
                            <ul data-bind="foreach: $parent.selectedEdges, dropZone: { accepts: 'available.edges', drop: $parent.onSelected.bind($parent) } "
                                class="list-unstyled dragdrop">
                                <li data-bind="attr: { title: id_ }, dragZone: { name: 'selected.edges' }">
                                    <div data-bind="attr: {
                                        title: type
                                    }, style: {
                                        backgroundImage: 'url(\'{% static '' %}' + '/img/hex/hex_' + ty + '_20.png\')'
                                    }" class="pull-left edgeTypeIcon"></div>
                                    <span data-bind="text: title"></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block body-end %}
    <script src="{% static 'js/moment.min.js' %}"></script>
    <script src="{% static "js/stickytape.js" %}"></script>
    <script>
        var require = {
            baseUrl: "{% static 'js' %}",
            paths: {
                knockout: "knockout-3.1.0",
                "knockout-dragdrop": "knockout.dragdrop"
            },
            urlArgs: "{% spaceless %}{% include 'publisher-version.html' %}{% endspaceless %}"
        };
    </script>
    <script src="{% static "js/require.js" %}" data-main="publisher/main"></script>
{% endblock %}
