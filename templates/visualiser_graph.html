{% load staticfiles %}

<template id="Graph">
    <div id="graph-container" class="col-sm-8 full-height">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
             preserveAspectRatio="xMidYMid meet"
             style="display:none;"
             data-bind="
                        forceGraph: graph,
                        charge:-2000,
                        distance:64,
                        friction:0.65,
                        gravity:0.5,
                        linkDistance:64,
                        linkStrength:0.25,
                        visible: true
                    ">
            <!-- ko foreach: links -->
            <line class="ko-d3-graph-link" data-bind="
                        attr: { class: className }
                    "></line>
            <!-- /ko -->
            <!-- ko foreach: nodes -->
            <!-- ko.toJSON(data) -->
            <g class="ko-d3-graph-node" data-bind="
                        attr: { title: title },

                        //click: $data.onNodeClicked.bind($data)
                    ">
                <image xlink:href="{% static 'img/hex/hex_.png' %}" class="" data-bind="
                            attr: {
                                id: id(),
                                class: className,
                                'xlink:href': '{% static 'img/hex/' %}hex_' + type() + '.png',
                                height: imageHeight(),
                                width: imageWidth(),
                                x: imageX(),
                                y: imageY()
                            }
                        "></image>
            </g>

            <!-- /ko -->
        </svg>
    </div>
    <div class="col-sm-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Details</h3>
            </div>
            <div class="panel-body">
                <!-- ko if: selectedTemplate() -->
                <div class="row" data-bind="template: { name: selectedTemplate(), data: selectedRoot }"></div>
                <!-- ko with: graph -->
                <dl data-bind="visible:true" class="linkedNodes" style="display:none">
                    <!-- ko with: selectedLinkedNodes -->
                    <!-- ko if: parentOf.length > 0 -->
                    <dt>References</dt>
                    <!-- ko foreach: parentOf -->
                    <dd data-bind="
                                            attr: {
                                                title: id
                                            },
                                            click:$parents[2].onNodeClicked.bind($parents[2])
                                        ">
                        <img data-bind="attr: {
                                                src: '{% static 'img/hex/hex_' %}' + type() + '_20.png'
                                            }">&nbsp;<span data-bind="text:title"></span>
                    </dd>
                    <!-- /ko -->
                    <!-- /ko -->
                    <!-- ko if: childOf.length > 0 -->
                    <dt>Referenced By</dt>
                    <!-- ko foreach: childOf -->
                    <dd data-bind="
                                            attr: {
                                                title: id
                                            },
                                            click:$parents[2].onNodeClicked.bind($parents[2])
                                        ">
                        <img data-bind="attr: {
                                                src: '{% static 'img/hex/hex_' %}' + type() + '_20.png'
                                            }">&nbsp;<span data-bind="text:title"></span>
                    </dd>
                    <!-- /ko -->
                    <!-- /ko -->
                    <!-- /ko -->
                </dl>
                <!-- /ko -->
                <!-- /ko -->
                <p data-bind="ifnot: selectedTemplate">Nothing selected</p>
            </div>
        </div>
    </div>
</template>
